!function(e){"object"==typeof exports?e(require("mithril"),require("underscore")):e(window.m,window._)}(function(e,t){var n={},r=e.prop(),o=function(e,n){return n&&t.isFunction(n.config)?t.compose(n.config,e):e},i=function(e){return function(n){return t.each(e,function(e,t){n.setRequestHeader(t,e)}),n}},u=i({Prefer:"return=representation"});n.token=r,n.loader=function(n,r,o){var o=o||!1,i=e.prop(o),u=e.deferred();return i.load=function(){return i(!0),e.redraw(),e.startComputation(),r(t.extend({},n,{background:!0})).then(function(t){i(!1),u.resolve(t),e.endComputation()},function(t){i(!1),u.reject(t),e.endComputation()}),u.promise},i},n.loaderWithToken=function(e,t){return n.loader(e,n.requestWithToken,t)},n.init=function(s,c){return n.request=function(n){return e.request(t.extend({},n,{url:s+n.url}))},n.authenticate=function(){var t=e.deferred();return r()?t.resolve({token:r()}):e.request(c).then(function(e){r(e.token),t.resolve({token:r()})},function(e){t.reject(e)}),t.promise},n.requestWithToken=function(n){var u=function(){return o(i({Authorization:"Bearer "+r()}),n)};return e.postgrest.authenticate().then(function(){return e.postgrest.request(t.extend({},n,{config:u()}))},function(){return e.postgrest.request(t.extend({},n))})},n.model=function(r){var s=function(e,t){var n=function(){var n=(e-1)*t,r=n+t-1;return n+"-"+r};return i({"Range-unit":"items",Range:n()})},c=e.prop(10),p={url:"/"+r},f=function(e,n,r,i){return t.extend({},i,p,{method:"GET",data:e,config:o(s(n,r),i)})},a=function(t,n){return n.url+="?"+e.route.buildQueryString(t),n},d=function(n){return e.postgrest.request(t.extend({},n,p,{method:"OPTIONS"}))},l=function(e,n){return t.extend({},n,p,{method:"POST",data:e,config:o(u,n)})},g=function(e,n){return a(e,t.extend({},n,p,{method:"DELETE"}))},h=function(e,n,r){return a(e,t.extend({},r,p,{method:"PATCH",data:n,config:o(u,r)}))},m=function(e,t,n){return f(e,t||1,c(),n)},q=function(e,t){return f(e,1,1,t)};return{pageSize:c,getPageOptions:m,getRowOptions:q,patchOptions:h,postOptions:l,deleteOptions:g,getPage:t.compose(n.request,m),getRow:t.compose(n.request,q),patch:t.compose(n.request,h),post:t.compose(n.request,l),deleteRequest:t.compose(n.request,g),getPageWithToken:t.compose(n.requestWithToken,m),getRowWithToken:t.compose(n.requestWithToken,q),patchWithToken:t.compose(n.requestWithToken,h),postWithToken:t.compose(n.requestWithToken,l),deleteWithToken:t.compose(n.requestWithToken,g),options:d}},n},e.postgrest=n}),function(e){"object"==typeof exports?e(require("mithril"),require("underscore")):e(window.m,window._)}(function(e,t){e.postgrest.filtersVM=function(n){var r={},o=function(){var t=e.prop(""),n=function(e){return arguments.length>0?(t(e),r):t()};return n.toFilter=function(){return(n()||"").toString().trim()},n},i=t.reduce(n,function(e,t,n){return"between"===t?e[n]={lte:o(),gte:o()}:e[n]=o(),e},{order:e.prop()}),u=function(){return t.reduce(i,function(e,r,o){if("order"!==o){var i=n[o];if(t.isFunction(r.toFilter)&&!r.toFilter())return e;if("ilike"===i||"like"===i)e[o]=i+".*"+r.toFilter()+"*";else if("@@"===i)e[o]=i+"."+r.toFilter().replace(/\s+/g,"&");else if("between"===i){if(!r.lte.toFilter()&&!r.gte.toFilter())return e;e[o]=[],r.gte()&&e[o].push("gte."+r.gte.toFilter()),r.lte()&&e[o].push("lte."+r.lte.toFilter())}else e[o]=i+"."+r.toFilter()}return e},{})},s=function(){var e=function(){return i.order()&&t.reduce(i.order(),function(e,t,n){return e.push(n+"."+t),e},[]).join(",")},n=e()?{order:e()}:{};return t.extend({},n,u())};return t.extend(r,i,{parameters:s,parametersWithoutOrder:u})}}),function(e){"object"==typeof exports?e(require("mithril"),require("underscore")):e(window.m,window._)}(function(e,t){e.postgrest.paginationVM=function(n,r){var o=e.prop([]),i=r||"id.desc",u=e.prop({order:i}),s=e.prop(!1),c=e.prop(1),p=e.prop(),f=function(){var r=e.deferred(),i=function(e){if(!e||0===e.status)return JSON.stringify({hint:null,details:null,code:0,message:"Connection error"});var n=e.getResponseHeader("Content-Range");t.isString(n)&&n.split("/").length>1&&p(parseInt(n.split("/")[1]));try{return JSON.parse(e.responseText),e.responseText}catch(r){return JSON.stringify({hint:null,details:null,code:0,message:e.responseText})}};return s(!0),n(u(),c(),{background:!0,extract:i}).then(function(n){o(t.union(o(),n)),s(!1),r.resolve(o()),e.redraw()},function(t){s(!1),p(0),r.reject(t),e.redraw()}),r.promise},a=function(e){return u(t.extend({order:i},e)),o([]),c(1),f()},d=function(){return c(c()+1),f()};return{collection:o,firstPage:a,isLoading:s,nextPage:d,total:p}}});